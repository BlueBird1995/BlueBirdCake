<div class="container">

  <h4 class="row ml-5 bg-light d-inline">注文情報確認</h4>

  <div class="row mt-3">
    <div class="col-md-7">
      <table class="table table-bordered">
        <tr class="bg-light">
          <td>商品名</td>
          <td>単価（税込）</td>
          <td>数量</td>
          <td>小計</td>
        </tr>
        <% @carts.each do |cart| %>
        <tr>
          <td><%= cart.product.name %></td>
          <td><%= cart.tax_included %></td>
          <td><%= cart.stock %></td>
          <td><%= cart.subtotal %></td>
        </tr>
        <% end %>
      </table>
    </div>

    <div class="col-md-4">
      <table class="table table-bordered">
        <%= form_for(@order, url: orders_path)do |f| %>
          <%# OrderedProductに送信 %>
          <% @carts.each do |cart| %>
            <%= f.fields_for :ordered_products do |ord| %>
                <%= ord.hidden_field :product_id, :value => cart.product.id %>
                <%= ord.hidden_field :stock, :value => cart.stock %>
                <%= ord.hidden_field :price, :value => cart.subtotal %>
            <% end %>
          <% end %>
            <tr>
              <th class="bg-light">送料</th>
              <td><%= @order.postage %></td>
            </tr>


        <%= hidden_field_tag :hidden, @carts %>

        <tr>
          <th class="bg-light">送料</th>
          <td><%= @order.postage %></td>
        </tr>

        <tr>
          <th class="bg-light">商品合計</th>
          <!-- 商品合計金額。個数ではないのでは？ -->
          <td><%= @total_stock %></td>
        </tr>

        <tr>
          <th class="bg-light">請求金額</th>
          <td><%= @total_price %></td>
        </tr>
      </table>
    </div>

  </div>

  <div class="container">
    <div class="row">
      <div class="col-md-2">
        <h6 class="font-weight-bold">支払方法</h6>
      </div>
      <div class="col-md-6">
        <p class="pt-2"><%= @order.payment_i18n %></p>
      </div>
    </div>

    <div class="row">
      <div class="col-md-2">
        <h6 class="font-weight-bold">お届け先</h6>
      </div>
      <div class="col-md-6 pt-2">

        <%= @order.postal_code %>
        <%= @order.address %><br>
        <%= @order.name %>
      </div>
    </div>
  </div>

  <%# Orderに送信 %>
  <%= f.hidden_field :user_id, :value => current_user.id %>
  <%= f.hidden_field :name, :value => @order.name %>
  <%= f.hidden_field :postal_code, :value => @order.postal_code %>
  <%= f.hidden_field :address, :value => @order.address %>
  <%= f.hidden_field :total_price, :value => 1000 %>
  <%= f.hidden_field :payment %>

  <div class="row">
    <div class="col-md-3 offset-4 mt-3">
      <%= f.submit '購入を確定する', class: "btn btn-success px-5" %>
    </div>
  </div>
  <% end %>
</div>